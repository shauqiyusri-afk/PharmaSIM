<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PharmaSim AI - Patient Simulation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .spin-360 {
      animation: spinOnce 2s ease-in-out;
      transform-style: preserve-3d;
    }

    @keyframes spinOnce {
      from { transform: rotateY(0deg); }
      to { transform: rotateY(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-xl shadow-md w-full max-w-md space-y-4">
    <h2 class="text-xl font-bold text-blue-700 text-center">AI Drug Simulation</h2>

    <form id="predictForm" class="space-y-4">
      <div>
        <label class="block font-medium">Race</label>
        <select name="race" required class="w-full p-2 border rounded">
          <option value="">-- Select --</option>
          <option value="Malay">Malay</option>
          <option value="Chinese">Chinese</option>
          <option value="Indian">Indian</option>
          <option value="Indigenous">Indigenous</option>
        </select>
      </div>

      <div>
        <label class="block font-medium">Gender</label>
        <select name="gender" required class="w-full p-2 border rounded">
          <option value="">-- Select --</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
      </div>

      <div>
        <label class="block font-medium">Age</label>
        <input type="number" name="age" min="0" required class="w-full p-2 border rounded">
      </div>

      <div>
        <label class="block font-medium">Symptom</label>
        <select name="symptom" required class="w-full p-2 border rounded">
          <option value="">-- Select --</option>
          <option value="Fever">Fever</option>
          <option value="Cough">Cough</option>
          <option value="Headache">Headache</option>
          <option value="Body Pain">Body Pain</option>
          <option value="Flu">Flu</option>
          <option value="Sore Throat">Sore Throat</option>
        </select>
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
        Simulate Recommendation
      </button>
    </form>

    <div id="resultBox" class="space-y-2 mt-4 hidden">
      <p id="resultMedicine" class="font-semibold text-green-700"></p>
      <p id="resultEffectiveness" class="text-sm text-gray-800"></p>
      <p id="resultRisk" class="text-sm text-red-700"></p>
      <p id="resultSideEffects" class="text-sm text-gray-700"></p>
      <img id="medicineImage" src="" alt="Medicine Image" class="mt-3 w-48 rounded shadow hidden">
    </div>
  </div>

  <script>
    const form = document.getElementById('predictForm');
    const resultBox = document.getElementById('resultBox');
    const medicineImage = document.getElementById('medicineImage');

    const resultMedicine = document.getElementById('resultMedicine');
    const resultEffectiveness = document.getElementById('resultEffectiveness');
    const resultRisk = document.getElementById('resultRisk');
    const resultSideEffects = document.getElementById('resultSideEffects');

    const medicineImages = {
      "Paracetamol": "images/Paracetamol.png",
      "Clarinase": "images/Clarinase.png",
      "Ibuprofen 400mg": "images/Ibuprofen.png",
      "Panadol Extend": "images/Panadol Extend.png",
      "Cetirizine": "images/Cetirizine.png",
      "Diphenhydramine": "images/Diphenhydramine.png"
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      resultMedicine.textContent = "Loading...";
      resultBox.classList.remove('hidden');

      try {
        const response = await fetch("http://127.0.0.1:5000/predict", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.recommended_medicine) {
          resultMedicine.textContent = `üß† Recommended Medicine: ${result.recommended_medicine}`;
          resultEffectiveness.textContent = `üìä Effectiveness Score: ${result.effectiveness_score}%`;
          resultRisk.textContent = `‚ö†Ô∏è Side Effect Risk: ${result.side_effect_risk}`;
          resultSideEffects.textContent = `üíä Common Side Effects: ${result.side_effects}`;

          const med = result.recommended_medicine;
          if (medicineImages[med]) {
            medicineImage.src = medicineImages[med];
            medicineImage.classList.remove('hidden');

            // Force restart animation
            medicineImage.classList.remove('spin-360');
            void medicineImage.offsetWidth; // force reflow
            medicineImage.classList.add('spin-360');

          } else {
            medicineImage.classList.add('hidden');
          }

        } else {
          resultMedicine.textContent = `‚ùå Error: ${result.error}`;
          resultEffectiveness.textContent = "";
          resultRisk.textContent = "";
          resultSideEffects.textContent = "";
          medicineImage.classList.add('hidden');
        }

      } catch (err) {
        resultMedicine.textContent = "‚ùå Server error. Please try again.";
        resultEffectiveness.textContent = "";
        resultRisk.textContent = "";
        resultSideEffects.textContent = "";
        medicineImage.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
